u4a.m.CircleMenuPosition={LEFT:"Left",CENTER:"Center",RIGHT:"Right"},sap.ui.define("u4a.m.CircleMenu",["sap/ui/core/Control","sap/ui/core/Icon","sap/m/Label","sap/ui/core/Popup"],function(e,c,d,t){"use strict";return e.extend("u4a.m.CircleMenu",{metadata:{library:"u4a.m",properties:{expanded:{type:"boolean",defaultValue:!1},position:{type:"u4a.m.CircleMenuPosition",defaultValue:u4a.m.CircleMenuPosition.CENTER}},defaultAggregation:"items",aggregations:{items:{type:"u4a.m.CircleMenuItem",multiple:!0,singularName:"item"},_popup:{type:"sap.ui.core.Popup",multiple:!1,visibility:"hidden"}},events:{itemPress:{}}},init:function(){this.setAggregation("_popup",new t),this.bIsDeskTop=sap.ui.Device.system.desktop,this.sBrowserName=sap.ui.Device.browser.name,this.bIsSafari=this.sBrowserName==sap.ui.Device.browser.BROWSER.SAFARI,this.bIsIE=this.sBrowserName==sap.ui.Device.browser.BROWSER.INTERNET_EXPLORER,this._bIsCircleDrag=!1,this._iBeforeRotateX=0,this._iInitDegreeStart=270,this._iDegreeGap=36},renderer:function(e,t){var i=t.getId(),n=t.getAggregation("_popup").getNextZIndex(),s=0==t.getExpanded()?"sap-icon://menu2":"sap-icon://decline",s=new c(i+"-ToggleBtnIcon",{src:s});switch(s.addStyleClass("u4aMCircleMenuToggleBtnIcon"),e.openStart("div",t),e.class("u4aMCircleMenu"),e.style("z-index",n+1),t.getExpanded()||e.class("u4aMCircleMenuInactive"),t.removeStyleClass("u4aMCircleMenuLeft"),t.removeStyleClass("u4aMCircleMenuRight"),t.getPosition()){case u4a.m.CircleMenuPosition.LEFT:e.class("u4aMCircleMenuLeft");break;case u4a.m.CircleMenuPosition.RIGHT:e.class("u4aMCircleMenuRight")}e.openEnd(),e.openStart("div",i+"-ToggleBtn"),e.class("u4aMCircleMenuToggleBtn"),e.style("z-index",n+2),e.openEnd(),e.openStart("div",i+"-ToggleBtnIconArea"),e.openEnd(),e.renderControl(s),e.close("div"),e.close("div"),e.openStart("div",i+"-ListItemArea"),e.class("u4aMCircleMenuListItemArea"),e.style("z-index",n+1),t.getExpanded()&&e.class("u4aMCircleMenuToggleBtnActive"),e.openEnd(),e.openStart("ul",i+"-Circle"),e.class("u4aMCircleMenuCircle"),e.openEnd(),t._renderItems(e,t),e.close("ul"),e.close("div"),e.close("div");s=i+"-BlockLayer",s=document.getElementById(s);s&&$(s).remove(),e.openStart("div",i+"-BlockLayer"),e.attr("tabindex","0"),e.style("zIndex",n),e.class("u4aMCircleMenuBlockLayer"),t.getExpanded()&&e.class("u4aMCircleMenuBlockLayerActive"),e.openEnd(),e.close("div")},onAfterRendering:function(){this._getCssLoad();var e=this.getId(),t=document.getElementById(e),i=document.getElementById(e+"-Circle"),n=document.getElementById(e+"-ToggleBtn"),s=document.getElementById(e+"-ListItemArea"),e=document.getElementById(e+"-BlockLayer");this.bIsDeskTop&&this.sBrowserName!=sap.ui.Device.browser.BROWSER.SAFARI?(t.addEventListener("mousedown",this._ToggleBtnClickHandle.bind(this)),i.addEventListener("mousedown",this._circleRotateMouseClickStartHandle.bind(this)),n.addEventListener("mousedown",this._ToggleBtnClickHandle.bind(this)),s.addEventListener("mousedown",this._ToggleBtnClickHandle.bind(this)),e.addEventListener("mousedown",this._ToggleBtnClickHandle.bind(this))):(t.addEventListener("touchstart",this._ToggleBtnClickHandle.bind(this)),i.addEventListener("touchstart",this._circleRotateMouseClickStartHandle.bind(this)),n.addEventListener("touchstart",this._ToggleBtnClickHandle.bind(this)),s.addEventListener("touchstart",this._ToggleBtnClickHandle.bind(this)),e.addEventListener("touchstart",this._ToggleBtnClickHandle.bind(this))),this.attachMenuItemEvent()},_getCssLoad:function(){var t="u4aMCircleMenu_style";document.getElementById(t)||jQuery.ajax({url:"/zu4a_imp/u4a_lib/v1000/css/m/u4aMCircleMenu.css",dataType:"text",async:!1,mimeType:"text/css",success:function(e){if(""==e)throw new Error("[U4AIDE] Load Fail to CircleMenu css files");$("<style id='"+t+"'></style>").appendTo("head").html(e)},error:function(e){throw new Error("[U4AIDE] Load Fail to CircleMenu css files")}})},setPosition:function(e){switch(this.setProperty("position",e,!0),this.$().removeClass("u4aMCircleMenuLeft"),this.$().removeClass("u4aMCircleMenuRight"),e){case u4a.m.CircleMenuPosition.LEFT:this.addStyleClass("u4aMCircleMenuLeft");break;case u4a.m.CircleMenuPosition.RIGHT:this.addStyleClass("u4aMCircleMenuRight")}},setExpanded:function(e){this.setProperty("expanded",e,!0),this._setExpanded(e)},attachMenuItemEvent:function(){var e=this.getItems(),t=e.length;if(0!=t)for(var i=this,n=0;n<t;n++){var s=e[n].getId(),o=document.getElementById(s);o&&(s=function(e){var t;i._bIsCircleDrag?i._bIsCircleDrag=!1:(t=sap.ui.getCore().byId(this.id),i.fireItemPress({selectedItem:t}),i.setExpanded(!i.getExpanded()))},this.bIsDeskTop&&this.sBrowserName!=sap.ui.Device.browser.BROWSER.SAFARI?o.addEventListener("mouseup",s):o.addEventListener("touchend",s))}},_circleRotateMouseClickStartHandle:function(e){e.preventDefault(),e.stopPropagation(),this._bIsCircleDrag=!1,this._circleRotateMouseClickEnd=this._circleRotateMouseClickEndHandle.bind(this),this._circleRotateMouseClickMove=this._circleRotateMouseMoveHandle.bind(this),this.bIsDeskTop&&this.sBrowserName!=sap.ui.Device.browser.BROWSER.SAFARI?(document.addEventListener("mouseup",this._circleRotateMouseClickEnd),document.addEventListener("mousemove",this._circleRotateMouseClickMove),this._clientX=e.clientX):(document.addEventListener("touchend",this._circleRotateMouseClickEnd),document.addEventListener("touchmove",this._circleRotateMouseClickMove),this._mclientX=e.changedTouches[0].clientX)},_circleRotateMouseMoveHandle:function(e){var t=this.bIsDeskTop,i=this.bIsSafari,n=(this.bIsIE,t&&!i?this._clientX:this._mclientX),e=(t&&!i?e:e.changedTouches[0]).clientX-n;0!=e&&(n=(e+this._iBeforeRotateX)/3,e=document.getElementById(this.getId()+"-Circle"),n={transform:"rotate("+n+"deg)"},$(e).css(n),this._bIsCircleDrag=!0)},_circleRotateMouseClickEndHandle:function(e){var t=this.bIsDeskTop,i=(this.sBrowserName,this.bIsSafari),n=(this.bIsIE,t&&!i?this._clientX:this._mclientX),n=(t&&!i?e:e.changedTouches[0]).clientX-n;this._iBeforeRotateX+=n,this._clientX=null,this._mclientX=null,document.removeEventListener("mouseup",this._circleRotateMouseClickEnd),document.removeEventListener("mousemove",this._circleRotateMouseClickMove),document.removeEventListener("touchend",this._circleRotateMouseClickEnd),document.removeEventListener("touchmove",this._circleRotateMouseClickMove),this._circleRotateMouseClickEnd=null,this._circleRotateMouseClickMove=null,this._bIsCircleDrag&&(this._bIsCircleDrag=!1)},_renderItems:function(e,t){var i=t.getItems(),n=i.length;if(0!=n)for(var s=this._iInitDegreeStart,o=this._iDegreeGap,l=0;l<n&&10!=l;l++){var a=i[l],r=a.getId();e.openStart("li",r+"-menuItem"+l),e.class("u4aMCircleMenuItem"),e.class("u4aMCircleMenuItem"+l),this.bIsIE?e.style("transform","rotate("+s+"deg) skewY(-55.01deg)"):e.style("transform","rotate("+s+"deg) skewY(-55deg)"),e.openEnd(),360<=(s+=o)&&(s-=360),e.openStart("div",r+"-placeholder"+l),e.class("u4aMCircleMenuItemPlaceHolder"),e.openEnd(),e.openStart("div",r+"-upside"+l),e.class("u4aMCircleMenuItemUpside"),e.openEnd(),e.openStart("a",a),e.class("u4aMCircleMenuItemLink"),e.openEnd(),e.renderControl(new c({size:"30px",src:a.getIcon()}).addStyleClass("u4aMCircleMenuItemIcon")),e.renderControl(new d({design:"Bold",wrapping:!0,width:"70px",textAlign:"Center",text:a.getDescription()}).addStyleClass("u4aMCircleMenuItemLabel")),e.close("a"),e.close("div"),e.close("div"),e.close("li")}},_setExpanded:function(e){var t=this.getId(),i=this.getAggregation("_popup").getNextZIndex(),n=t+"-ToggleBtn",s="",o=t+"-ToggleBtnIcon",l=t+"-ListItemArea",t=t+"-BlockLayer",n=document.getElementById(n),o=sap.ui.getCore().byId(o),l=document.getElementById(l),t=document.getElementById(t);(o||l||t)&&($(l).removeClass("u4aMCircleMenuToggleBtnActive"),$(t).removeClass("u4aMCircleMenuBlockLayerActive"),document.removeEventListener("keydown",this._KeydownEventHandle),e?(document.addEventListener("keydown",this._KeydownEventHandle),s="sap-icon://decline",this.$().removeClass("u4aMCircleMenuInactive"),$(l).addClass("u4aMCircleMenuToggleBtnActive"),$(t).addClass("u4aMCircleMenuBlockLayerActive"),this.$().css("zIndex",i+1),$(n).css("zIndex",i+2),$(l).css("zIndex",i+1),$(t).css("zIndex",i)):(this.$().addClass("u4aMCircleMenuInactive"),s="sap-icon://menu2"),o.setSrc(s))},_ToggleBtnClickHandle:function(e){document.activeElement.blur(),e.preventDefault(),e.stopPropagation();var t=jQuery(e.target),i=t.closest(".u4aMCircleMenu"),e=(t.closest(".u4aMCircleMenuListItemArea"),t.closest(".u4aMCircleMenuToggleBtn")),t=(t.closest(".u4aMCircleMenuItemPlaceHolder"),t.closest(".u4aMCircleMenuBlockLayerActive"));(e.length||t.length||i.length)&&(1!=i.length&&1!=e.length&&1!=t.length||this.setExpanded(!this.getExpanded()))},_KeydownEventHandle:function(e){if(9==event.keyCode)return event.preventDefault(),event.stopPropagation(),!1},exit:function(){var e=this.getAggregation("_popup");e&&e.destroy(),this.bIsDeskTop=null,delete this.bIsDeskTop,this.sBrowserName=null,delete this.sBrowserName,this.bIsSafari=null,delete this.bIsSafari,this.bIsIE=null,delete this.bIsIE,this._bIsCircleDrag=null,delete this._bIsCircleDrag,this._iBeforeRotateX=null,delete this._iBeforeRotateX,this._iInitDegreeStart=null,delete this._iInitDegreeStart,this._iDegreeGap=null,delete this._iDegreeGap;var t=this.getId(),i=document.getElementById(t),n=document.getElementById(t+"-Circle"),s=document.getElementById(t+"-ToggleBtn"),e=document.getElementById(t+"-ListItemArea"),t=document.getElementById(t+"-BlockLayer");i.removeEventListener("mousedown",this._ToggleBtnClickHandle.bind(this)),n.removeEventListener("mousedown",this._circleRotateMouseClickStartHandle.bind(this)),s.removeEventListener("mousedown",this._ToggleBtnClickHandle.bind(this)),e.removeEventListener("mousedown",this._ToggleBtnClickHandle.bind(this)),t.removeEventListener("mousedown",this._ToggleBtnClickHandle.bind(this)),i.removeEventListener("touchstart",this._ToggleBtnClickHandle.bind(this)),n.removeEventListener("touchstart",this._circleRotateMouseClickStartHandle.bind(this)),s.removeEventListener("touchstart",this._ToggleBtnClickHandle.bind(this)),e.removeEventListener("touchstart",this._ToggleBtnClickHandle.bind(this)),t.removeEventListener("touchstart",this._ToggleBtnClickHandle.bind(this))}})});